applications:
  - espejote

parameters:
  kapitan:
    dependencies:
      - type: https
        source: https://raw.githubusercontent.com/projectsyn/component-espejote/master/lib/espejote.libsonnet
        output_path: vendor/lib/espejote.libsonnet

  espejote:
    namespace: syn-espejote

  rbac:
    namespace: syn-serviceaccounts
    manageNamespace: true

    serviceaccounts:
      foo/bar:
        metadata:
          labels:
            foo: "false"
      buzz: {}
    clusterroles:
      raw:
        rules:
          - apiGroups:
              - ""
            resources:
              - namespaces
            verbs:
              - create
      helper:
        rules_:
          create:
            apiGroups:
              - ""
            resources:
              - namespaces
            verbs:
              - create
              - ~delete
    clusterrolebindings:
      raw:
        roleRef:
          apiGroup: rbac.authorization.k8s.io
          kind: ClusterRole
          name: raw
        subjects:
          - kind: ServiceAccount
            name: bar
            namespace: foo
      helper:
        clusterRole_: helper
        subjects_:
          serviceaccounts:
            - foo/bar
            - ~foo/buz
            - buzz
          users:
            - buzz
            - ~blib
          groups:
            - org
            - ~root
    roles:
      foo/raw:
        rules:
          - apiGroups:
              - ""
            resources:
              - configmaps
            verbs:
              - create
      foo/helper:
        rules_:
          create:
            apiGroups:
              - ""
            resources:
              - configmaps
            verbs:
              - create
              - ~delete
    rolebindings:
      foo/raw:
        roleRef:
          apiGroup: rbac.authorization.k8s.io
          kind: Role
          name: raw
        subjects:
          - kind: ServiceAccount
            name: bar
            namespace: foo
      foo/helper:
        role_: helper
        subjects_:
          serviceaccounts:
            - bar
            - ~foo/buz
          users:
            - buzz
            - ~blib
          groups:
            - org
            - ~root

    namespaceSync:
      templates:
        role/read-configmaps:
          rules_:
            read:
              apiGroups:
                - ""
              resources:
                - configmaps
              verbs:
                - get
                - list
                - watch
                - ~delete
        rolebinding/read-configmaps:
          role_: read-configmaps
          subjects_:
            serviceaccounts:
              - null/buzz
              - ~blib
      templateSets:
        test1:
          - role/read-configmaps
          - rolebinding/read-configmaps
